<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊源代码 - 挖矿打包流程以及速度 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊源代码 - 挖矿打包流程以及速度" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="原文地址 worker负责整个挖矿打包流程，代码查看miner/worker.go文件。 1）打包流程 commitNewWork是打包流程的开始，具体的调用关系如下： *）步骤6 - 创建Work，所谓的Work即目前打包的执行环境。 *）步骤7 - 执行pending的交易，记录交易的receipts。 *）步骤8 - 生成具体的区块信息。 *）步骤10 - 生成好的区块数据，发送给miner.CpuAgent。CpuAgent调用Engine的Seal函数打包。 *）步骤13 - 打包后的Work发送回miner（通过chan）。 *）步骤15/16 - 更新链信息以及发出区块生成事件。 从上图可以看出，consensus.Engine是打包逻辑的接口（consensus/consensus.go）： // Engine is an algorithm agnostic consensus engine. type Engine interface { // Author retrieves the Ethereum address of the account that minted the given // block, which may be different from the header&#39;s coinbase if a consensus // engine is based on signatures. Author(header *types.Header) (common.Address, error) // VerifyHeader checks whether a header conforms to the consensus rules of a // given engine. Verifying the seal may be done optionally here, or explicitly // via the VerifySeal method. VerifyHeader(chain ChainReader, header *types.Header, seal bool) error // VerifyHeaders is similar to VerifyHeader, but verifies a batch of headers // concurrently. The method returns a quit channel to abort the operations and // a results channel to retrieve the async verifications (the order is that of // the input slice). VerifyHeaders(chain ChainReader, headers []*types.Header, seals []bool) (chan&lt;- struct{}, &lt;-chan error) // VerifyUncles verifies that the given block&#39;s uncles conform to the consensus // rules of a given engine. VerifyUncles(chain ChainReader, block *types.Block) error // VerifySeal checks whether the crypto seal on a header is valid according to // the consensus rules of the given engine. VerifySeal(chain ChainReader, header *types.Header) error // Prepare initializes the consensus fields of a block header according to the // rules of a particular engine. The changes are executed inline. Prepare(chain ChainReader, header *types.Header) error // Finalize runs any post-transaction state modifications (e.g. block rewards) // and assembles the final block. // Note: The block header and state database might be updated to reflect any // consensus rules that happen at finalization (e.g. block rewards). Finalize(chain ChainReader, header *types.Header, state *state.StateDB, txs []*types.Transaction, uncles []*types.Header, receipts []*types.Receipt) (*types.Block, error) // Seal generates a new block for the given input block with the local miner&#39;s // seal place on top. Seal(chain ChainReader, block *types.Block, stop &lt;-chan struct{}) (*types.Block, error) // CalcDifficulty is the difficulty adjustment algorithm. It returns the difficulty // that a new block should have. CalcDifficulty(chain ChainReader, time uint64, parent *types.Header) *big.Int // APIs returns the RPC APIs this consensus engine provides. APIs(chain ChainReader) []rpc.API } // PoW is a consensus engine based on proof-of-work. type PoW interface { Engine // Hashrate returns the current mining hashrate of a PoW consensus engine. Hashrate() float64 } 在consensus目录下还有Engine的两个具体实现： 1）clique (测试网络使用），基于POA（proof of authority) &nbsp;2）ethash（正式网络使用），基于POW（proof of work）。 2）打包出块速度 在上图中的Engine的接口中，有个接口函数 - CalcDifficulty。这个接口是计算当前区块的难度，调节以太网络的出块速度。 查看ethash的实现，CalcDifficulty函数实现在consensus/ethash/consensus.go文件： // CalcDifficulty is the difficulty adjustment algorithm. It returns // the difficulty that a new block should have when created at time // given the parent block&#39;s time and difficulty. func CalcDifficulty(config *params.ChainConfig, time uint64, parent *types.Header) *big.Int { next := new(big.Int).Add(parent.Number, big1) switch { case config.IsByzantium(next): return calcDifficultyByzantium(time, parent) case config.IsHomestead(next): return calcDifficultyHomestead(time, parent) default: return calcDifficultyFrontier(time, parent) } } 以太根据块的高度做了一些难度策略的调整。这里着重看一下，最新的策略：calcDifficultyByzantium函数。 // calcDifficultyByzantium is the difficulty adjustment algorithm. It returns // the difficulty that a new block should have when created at time given the // parent block&#39;s time and difficulty. The calculation uses the Byzantium rules. func calcDifficultyByzantium(time uint64, parent *types.Header) *big.Int { // https://github.com/ethereum/EIPs/issues/100. // algorithm: // diff = (parent_diff + // (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99)) // ) + 2^(periodCount - 2) bigTime := new(big.Int).SetUint64(time) bigParentTime := new(big.Int).Set(parent.Time) // holds intermediate values to make the algo easier to read &amp; audit x := new(big.Int) y := new(big.Int) // (2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9 x.Sub(bigTime, bigParentTime) x.Div(x, big9) if parent.UncleHash == types.EmptyUncleHash { x.Sub(big1, x) } else { x.Sub(big2, x) } // max((2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9, -99) if x.Cmp(bigMinus99) &lt; 0 { x.Set(bigMinus99) } // parent_diff + (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99)) y.Div(parent.Difficulty, params.DifficultyBoundDivisor) x.Mul(y, x) x.Add(parent.Difficulty, x) // minimum difficulty can ever be (before exponential factor) if x.Cmp(params.MinimumDifficulty) &lt; 0 { x.Set(params.MinimumDifficulty) } // calculate a fake block number for the ice-age delay: // https://github.com/ethereum/EIPs/pull/669 // fake_block_number = min(0, block.number - 3_000_000 fakeBlockNumber := new(big.Int) if parent.Number.Cmp(big2999999) &gt;= 0 { fakeBlockNumber = fakeBlockNumber.Sub(parent.Number, big2999999) // Note, parent is 1 less than the actual block number } // for the exponential factor periodCount := fakeBlockNumber periodCount.Div(periodCount, expDiffPeriod) // the exponential factor, commonly referred to as &quot;the bomb&quot; // diff = diff + 2^(periodCount - 2) if periodCount.Cmp(big1) &gt; 0 { y.Sub(periodCount, big2) y.Exp(big2, y, nil) x.Add(x, y) } return x } 在函数的注释中，明确给出了难度调整的算法。算法调整分为两个部分： 1）parent_diff/2048*max(1-(时间差/9), -99) （如果没有叔块） 简单的说，假设当前块和上一块的时间差为X秒： X&lt;9: 增加难度，增加上一块区块难度的1/2048。 9&lt;X&lt;18: 保持上一块区块难度不变。 X&gt;27: 减少难度，较少上一块区块难度的1/2048个倍数，倍数最大为99。 2）2^(periodCount-2) （又称难度炸弹） periodCount的计算公式：(上个区块的高度 - 3000000)/100000。从etherscan上查看最新的区块信息： 当前的高度是5577040，难度炸弹的值为：2^23 = 8388608。目前，这个炸弹的值相对来说可以忽略。 总结一下：目前难度调整的目的是将打包速度调整在9到18秒之间。也就是，大多数人说的，打包时间大约15秒。 阅读更多" />
<meta property="og:description" content="原文地址 worker负责整个挖矿打包流程，代码查看miner/worker.go文件。 1）打包流程 commitNewWork是打包流程的开始，具体的调用关系如下： *）步骤6 - 创建Work，所谓的Work即目前打包的执行环境。 *）步骤7 - 执行pending的交易，记录交易的receipts。 *）步骤8 - 生成具体的区块信息。 *）步骤10 - 生成好的区块数据，发送给miner.CpuAgent。CpuAgent调用Engine的Seal函数打包。 *）步骤13 - 打包后的Work发送回miner（通过chan）。 *）步骤15/16 - 更新链信息以及发出区块生成事件。 从上图可以看出，consensus.Engine是打包逻辑的接口（consensus/consensus.go）： // Engine is an algorithm agnostic consensus engine. type Engine interface { // Author retrieves the Ethereum address of the account that minted the given // block, which may be different from the header&#39;s coinbase if a consensus // engine is based on signatures. Author(header *types.Header) (common.Address, error) // VerifyHeader checks whether a header conforms to the consensus rules of a // given engine. Verifying the seal may be done optionally here, or explicitly // via the VerifySeal method. VerifyHeader(chain ChainReader, header *types.Header, seal bool) error // VerifyHeaders is similar to VerifyHeader, but verifies a batch of headers // concurrently. The method returns a quit channel to abort the operations and // a results channel to retrieve the async verifications (the order is that of // the input slice). VerifyHeaders(chain ChainReader, headers []*types.Header, seals []bool) (chan&lt;- struct{}, &lt;-chan error) // VerifyUncles verifies that the given block&#39;s uncles conform to the consensus // rules of a given engine. VerifyUncles(chain ChainReader, block *types.Block) error // VerifySeal checks whether the crypto seal on a header is valid according to // the consensus rules of the given engine. VerifySeal(chain ChainReader, header *types.Header) error // Prepare initializes the consensus fields of a block header according to the // rules of a particular engine. The changes are executed inline. Prepare(chain ChainReader, header *types.Header) error // Finalize runs any post-transaction state modifications (e.g. block rewards) // and assembles the final block. // Note: The block header and state database might be updated to reflect any // consensus rules that happen at finalization (e.g. block rewards). Finalize(chain ChainReader, header *types.Header, state *state.StateDB, txs []*types.Transaction, uncles []*types.Header, receipts []*types.Receipt) (*types.Block, error) // Seal generates a new block for the given input block with the local miner&#39;s // seal place on top. Seal(chain ChainReader, block *types.Block, stop &lt;-chan struct{}) (*types.Block, error) // CalcDifficulty is the difficulty adjustment algorithm. It returns the difficulty // that a new block should have. CalcDifficulty(chain ChainReader, time uint64, parent *types.Header) *big.Int // APIs returns the RPC APIs this consensus engine provides. APIs(chain ChainReader) []rpc.API } // PoW is a consensus engine based on proof-of-work. type PoW interface { Engine // Hashrate returns the current mining hashrate of a PoW consensus engine. Hashrate() float64 } 在consensus目录下还有Engine的两个具体实现： 1）clique (测试网络使用），基于POA（proof of authority) &nbsp;2）ethash（正式网络使用），基于POW（proof of work）。 2）打包出块速度 在上图中的Engine的接口中，有个接口函数 - CalcDifficulty。这个接口是计算当前区块的难度，调节以太网络的出块速度。 查看ethash的实现，CalcDifficulty函数实现在consensus/ethash/consensus.go文件： // CalcDifficulty is the difficulty adjustment algorithm. It returns // the difficulty that a new block should have when created at time // given the parent block&#39;s time and difficulty. func CalcDifficulty(config *params.ChainConfig, time uint64, parent *types.Header) *big.Int { next := new(big.Int).Add(parent.Number, big1) switch { case config.IsByzantium(next): return calcDifficultyByzantium(time, parent) case config.IsHomestead(next): return calcDifficultyHomestead(time, parent) default: return calcDifficultyFrontier(time, parent) } } 以太根据块的高度做了一些难度策略的调整。这里着重看一下，最新的策略：calcDifficultyByzantium函数。 // calcDifficultyByzantium is the difficulty adjustment algorithm. It returns // the difficulty that a new block should have when created at time given the // parent block&#39;s time and difficulty. The calculation uses the Byzantium rules. func calcDifficultyByzantium(time uint64, parent *types.Header) *big.Int { // https://github.com/ethereum/EIPs/issues/100. // algorithm: // diff = (parent_diff + // (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99)) // ) + 2^(periodCount - 2) bigTime := new(big.Int).SetUint64(time) bigParentTime := new(big.Int).Set(parent.Time) // holds intermediate values to make the algo easier to read &amp; audit x := new(big.Int) y := new(big.Int) // (2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9 x.Sub(bigTime, bigParentTime) x.Div(x, big9) if parent.UncleHash == types.EmptyUncleHash { x.Sub(big1, x) } else { x.Sub(big2, x) } // max((2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9, -99) if x.Cmp(bigMinus99) &lt; 0 { x.Set(bigMinus99) } // parent_diff + (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99)) y.Div(parent.Difficulty, params.DifficultyBoundDivisor) x.Mul(y, x) x.Add(parent.Difficulty, x) // minimum difficulty can ever be (before exponential factor) if x.Cmp(params.MinimumDifficulty) &lt; 0 { x.Set(params.MinimumDifficulty) } // calculate a fake block number for the ice-age delay: // https://github.com/ethereum/EIPs/pull/669 // fake_block_number = min(0, block.number - 3_000_000 fakeBlockNumber := new(big.Int) if parent.Number.Cmp(big2999999) &gt;= 0 { fakeBlockNumber = fakeBlockNumber.Sub(parent.Number, big2999999) // Note, parent is 1 less than the actual block number } // for the exponential factor periodCount := fakeBlockNumber periodCount.Div(periodCount, expDiffPeriod) // the exponential factor, commonly referred to as &quot;the bomb&quot; // diff = diff + 2^(periodCount - 2) if periodCount.Cmp(big1) &gt; 0 { y.Sub(periodCount, big2) y.Exp(big2, y, nil) x.Add(x, y) } return x } 在函数的注释中，明确给出了难度调整的算法。算法调整分为两个部分： 1）parent_diff/2048*max(1-(时间差/9), -99) （如果没有叔块） 简单的说，假设当前块和上一块的时间差为X秒： X&lt;9: 增加难度，增加上一块区块难度的1/2048。 9&lt;X&lt;18: 保持上一块区块难度不变。 X&gt;27: 减少难度，较少上一块区块难度的1/2048个倍数，倍数最大为99。 2）2^(periodCount-2) （又称难度炸弹） periodCount的计算公式：(上个区块的高度 - 3000000)/100000。从etherscan上查看最新的区块信息： 当前的高度是5577040，难度炸弹的值为：2^23 = 8388608。目前，这个炸弹的值相对来说可以忽略。 总结一下：目前难度调整的目的是将打包速度调整在9到18秒之间。也就是，大多数人说的，打包时间大约15秒。 阅读更多" />
<link rel="canonical" href="http://0.0.0.0:4000/2018/05/29/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%BA%90%E4%BB%A3%E7%A0%81-%E6%8C%96%E7%9F%BF%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E9%80%9F%E5%BA%A6.html" />
<meta property="og:url" content="http://0.0.0.0:4000/2018/05/29/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%BA%90%E4%BB%A3%E7%A0%81-%E6%8C%96%E7%9F%BF%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E9%80%9F%E5%BA%A6.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"原文地址 worker负责整个挖矿打包流程，代码查看miner/worker.go文件。 1）打包流程 commitNewWork是打包流程的开始，具体的调用关系如下： *）步骤6 - 创建Work，所谓的Work即目前打包的执行环境。 *）步骤7 - 执行pending的交易，记录交易的receipts。 *）步骤8 - 生成具体的区块信息。 *）步骤10 - 生成好的区块数据，发送给miner.CpuAgent。CpuAgent调用Engine的Seal函数打包。 *）步骤13 - 打包后的Work发送回miner（通过chan）。 *）步骤15/16 - 更新链信息以及发出区块生成事件。 从上图可以看出，consensus.Engine是打包逻辑的接口（consensus/consensus.go）： // Engine is an algorithm agnostic consensus engine. type Engine interface { // Author retrieves the Ethereum address of the account that minted the given // block, which may be different from the header&#39;s coinbase if a consensus // engine is based on signatures. Author(header *types.Header) (common.Address, error) // VerifyHeader checks whether a header conforms to the consensus rules of a // given engine. Verifying the seal may be done optionally here, or explicitly // via the VerifySeal method. VerifyHeader(chain ChainReader, header *types.Header, seal bool) error // VerifyHeaders is similar to VerifyHeader, but verifies a batch of headers // concurrently. The method returns a quit channel to abort the operations and // a results channel to retrieve the async verifications (the order is that of // the input slice). VerifyHeaders(chain ChainReader, headers []*types.Header, seals []bool) (chan&lt;- struct{}, &lt;-chan error) // VerifyUncles verifies that the given block&#39;s uncles conform to the consensus // rules of a given engine. VerifyUncles(chain ChainReader, block *types.Block) error // VerifySeal checks whether the crypto seal on a header is valid according to // the consensus rules of the given engine. VerifySeal(chain ChainReader, header *types.Header) error // Prepare initializes the consensus fields of a block header according to the // rules of a particular engine. The changes are executed inline. Prepare(chain ChainReader, header *types.Header) error // Finalize runs any post-transaction state modifications (e.g. block rewards) // and assembles the final block. // Note: The block header and state database might be updated to reflect any // consensus rules that happen at finalization (e.g. block rewards). Finalize(chain ChainReader, header *types.Header, state *state.StateDB, txs []*types.Transaction, uncles []*types.Header, receipts []*types.Receipt) (*types.Block, error) // Seal generates a new block for the given input block with the local miner&#39;s // seal place on top. Seal(chain ChainReader, block *types.Block, stop &lt;-chan struct{}) (*types.Block, error) // CalcDifficulty is the difficulty adjustment algorithm. It returns the difficulty // that a new block should have. CalcDifficulty(chain ChainReader, time uint64, parent *types.Header) *big.Int // APIs returns the RPC APIs this consensus engine provides. APIs(chain ChainReader) []rpc.API } // PoW is a consensus engine based on proof-of-work. type PoW interface { Engine // Hashrate returns the current mining hashrate of a PoW consensus engine. Hashrate() float64 } 在consensus目录下还有Engine的两个具体实现： 1）clique (测试网络使用），基于POA（proof of authority) &nbsp;2）ethash（正式网络使用），基于POW（proof of work）。 2）打包出块速度 在上图中的Engine的接口中，有个接口函数 - CalcDifficulty。这个接口是计算当前区块的难度，调节以太网络的出块速度。 查看ethash的实现，CalcDifficulty函数实现在consensus/ethash/consensus.go文件： // CalcDifficulty is the difficulty adjustment algorithm. It returns // the difficulty that a new block should have when created at time // given the parent block&#39;s time and difficulty. func CalcDifficulty(config *params.ChainConfig, time uint64, parent *types.Header) *big.Int { next := new(big.Int).Add(parent.Number, big1) switch { case config.IsByzantium(next): return calcDifficultyByzantium(time, parent) case config.IsHomestead(next): return calcDifficultyHomestead(time, parent) default: return calcDifficultyFrontier(time, parent) } } 以太根据块的高度做了一些难度策略的调整。这里着重看一下，最新的策略：calcDifficultyByzantium函数。 // calcDifficultyByzantium is the difficulty adjustment algorithm. It returns // the difficulty that a new block should have when created at time given the // parent block&#39;s time and difficulty. The calculation uses the Byzantium rules. func calcDifficultyByzantium(time uint64, parent *types.Header) *big.Int { // https://github.com/ethereum/EIPs/issues/100. // algorithm: // diff = (parent_diff + // (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99)) // ) + 2^(periodCount - 2) bigTime := new(big.Int).SetUint64(time) bigParentTime := new(big.Int).Set(parent.Time) // holds intermediate values to make the algo easier to read &amp; audit x := new(big.Int) y := new(big.Int) // (2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9 x.Sub(bigTime, bigParentTime) x.Div(x, big9) if parent.UncleHash == types.EmptyUncleHash { x.Sub(big1, x) } else { x.Sub(big2, x) } // max((2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9, -99) if x.Cmp(bigMinus99) &lt; 0 { x.Set(bigMinus99) } // parent_diff + (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99)) y.Div(parent.Difficulty, params.DifficultyBoundDivisor) x.Mul(y, x) x.Add(parent.Difficulty, x) // minimum difficulty can ever be (before exponential factor) if x.Cmp(params.MinimumDifficulty) &lt; 0 { x.Set(params.MinimumDifficulty) } // calculate a fake block number for the ice-age delay: // https://github.com/ethereum/EIPs/pull/669 // fake_block_number = min(0, block.number - 3_000_000 fakeBlockNumber := new(big.Int) if parent.Number.Cmp(big2999999) &gt;= 0 { fakeBlockNumber = fakeBlockNumber.Sub(parent.Number, big2999999) // Note, parent is 1 less than the actual block number } // for the exponential factor periodCount := fakeBlockNumber periodCount.Div(periodCount, expDiffPeriod) // the exponential factor, commonly referred to as &quot;the bomb&quot; // diff = diff + 2^(periodCount - 2) if periodCount.Cmp(big1) &gt; 0 { y.Sub(periodCount, big2) y.Exp(big2, y, nil) x.Add(x, y) } return x } 在函数的注释中，明确给出了难度调整的算法。算法调整分为两个部分： 1）parent_diff/2048*max(1-(时间差/9), -99) （如果没有叔块） 简单的说，假设当前块和上一块的时间差为X秒： X&lt;9: 增加难度，增加上一块区块难度的1/2048。 9&lt;X&lt;18: 保持上一块区块难度不变。 X&gt;27: 减少难度，较少上一块区块难度的1/2048个倍数，倍数最大为99。 2）2^(periodCount-2) （又称难度炸弹） periodCount的计算公式：(上个区块的高度 - 3000000)/100000。从etherscan上查看最新的区块信息： 当前的高度是5577040，难度炸弹的值为：2^23 = 8388608。目前，这个炸弹的值相对来说可以忽略。 总结一下：目前难度调整的目的是将打包速度调整在9到18秒之间。也就是，大多数人说的，打包时间大约15秒。 阅读更多","@type":"BlogPosting","url":"http://0.0.0.0:4000/2018/05/29/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%BA%90%E4%BB%A3%E7%A0%81-%E6%8C%96%E7%9F%BF%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E9%80%9F%E5%BA%A6.html","headline":"以太坊源代码 - 挖矿打包流程以及速度","dateModified":"2018-05-29T00:00:00+08:00","datePublished":"2018-05-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/2018/05/29/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%BA%90%E4%BB%A3%E7%A0%81-%E6%8C%96%E7%9F%BF%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E9%80%9F%E5%BA%A6.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>

  </head>
  <body>
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊源代码 - 挖矿打包流程以及速度</h1>
        
        
        <ul>
            <li><a href="https://blog.uzzz.org/" target="_blank"><strong>柚子社区<br/>(国际版)</strong></a></li>
            <li><a href="https://blog.uzzz.org.cn/" target="_blank"><strong>柚子社区<br/>(国内版)</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

      <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><a href="https://mp.weixin.qq.com/s?__biz=MzU5MzMxNTk2Nw==&amp;mid=2247484016&amp;idx=1&amp;sn=9a349a6d7a05254c84c19f21c16a0bbe&amp;chksm=fe131360c9649a76ccebd44ae31938c7eafeaa7efa85cdaa461e07206747e71210e7b1b82e7b&amp;mpshare=1&amp;scene=23&amp;srcid=05295KSzAfVnpSniwDvYPb0L#rd" rel="nofollow">原文地址</a></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">worker负责整个挖矿打包流程，代码查看miner/worker.go文件。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><span><strong>1）打包流程</strong></span></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">commitNewWork是打包流程的开始，具体的调用关系如下：</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180529202014196" alt=""><br></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">*）步骤6 - 创建Work，所谓的Work即目前打包的执行环境。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">*）步骤7 - 执行pending的交易，记录交易的receipts。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">*）步骤8 - 生成具体的区块信息。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">*）步骤10 - 生成好的区块数据，发送给miner.CpuAgent。CpuAgent调用Engine的Seal函数打包。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">*）步骤13 - 打包后的Work发送回miner（通过chan）。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">*）步骤15/16 - 更新链信息以及发出区块生成事件。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">从上图可以看出，consensus.Engine是打包逻辑的接口（consensus/consensus.go）：</p>
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Engine</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">an</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">algorithm</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">agnostic</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine.</span></pre>
  <pre><span style="font-weight:600;color:#000080;">type</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">Engine</span><span style="color:#c0c0c0;"> </span><span style="font-weight:600;color:#000080;">interface</span><span style="color:#c0c0c0;"> </span>{</pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Author</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">retrieves</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Ethereum</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">address</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">account</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">that</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">minted</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">which</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">may</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">be</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">different</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">from</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">header's</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">coinbase</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">if</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">based</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">on</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">signatures.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>Author(header<span style="color:#c0c0c0;"> </span>*types.Header)<span style="color:#c0c0c0;"> </span>(common.Address,<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span>)</pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifyHeader</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">checks</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">whether</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">header</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">conforms</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rules</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Verifying</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">seal</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">may</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">be</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">done</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">optionally</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">here,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">or</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">explicitly</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">via</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifySeal</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">method.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>VerifyHeader(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>header<span style="color:#c0c0c0;"> </span>*types.Header,<span style="color:#c0c0c0;"> </span>seal<span style="color:#c0c0c0;"> </span><span style="color:#000080;">bool</span>)<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifyHeaders</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">similar</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifyHeader,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">but</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">verifies</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">batch</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">headers</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">concurrently.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">The</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">method</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">returns</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">quit</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">channel</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">abort</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">operations</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">and</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">results</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">channel</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">retrieve</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">async</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">verifications</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">(the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">order</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">that</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">input</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">slice).</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>VerifyHeaders(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>headers<span style="color:#c0c0c0;"> </span>[]*types.Header,<span style="color:#c0c0c0;"> </span>seals<span style="color:#c0c0c0;"> </span>[]<span style="color:#000080;">bool</span>)<span style="color:#c0c0c0;"> </span>(<span style="font-weight:600;color:#000080;">chan</span>&lt;-<span style="color:#c0c0c0;"> </span><span style="font-weight:600;color:#000080;">struct</span>{},<span style="color:#c0c0c0;"> </span>&lt;-<span style="font-weight:600;color:#000080;">chan</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span>)</pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifyUncles</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">verifies</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">that</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block's</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">uncles</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">conform</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rules</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>VerifyUncles(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>block<span style="color:#c0c0c0;"> </span>*types.Block)<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifySeal</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">checks</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">whether</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">crypto</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">seal</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">on</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">header</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">valid</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">according</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rules</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>VerifySeal(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>header<span style="color:#c0c0c0;"> </span>*types.Header)<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Prepare</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">initializes</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">fields</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">header</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">according</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rules</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">particular</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">The</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">changes</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">are</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">executed</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">inline.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>Prepare(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>header<span style="color:#c0c0c0;"> </span>*types.Header)<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Finalize</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">runs</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">any</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">post-transaction</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">modifications</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">(e.g.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rewards)</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">and</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">assembles</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">final</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Note:</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">The</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">header</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">and</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">database</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">might</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">be</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">updated</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">reflect</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">any</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rules</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">that</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">happen</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">at</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">finalization</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">(e.g.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">rewards).</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>Finalize(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>header<span style="color:#c0c0c0;"> </span>*types.Header,<span style="color:#c0c0c0;"> </span>state<span style="color:#c0c0c0;"> </span>*state.StateDB,<span style="color:#c0c0c0;"> </span>txs<span style="color:#c0c0c0;"> </span>[]*types.Transaction,</pre>
  <pre><span style="color:#c0c0c0;">		</span>uncles<span style="color:#c0c0c0;"> </span>[]*types.Header,<span style="color:#c0c0c0;"> </span>receipts<span style="color:#c0c0c0;"> </span>[]*types.Receipt)<span style="color:#c0c0c0;"> </span>(*types.Block,<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span>)</pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Seal</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">generates</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">new</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">for</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">input</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">with</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">local</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">miner's</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">seal</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">place</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">on</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">top.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>Seal(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>block<span style="color:#c0c0c0;"> </span>*types.Block,<span style="color:#c0c0c0;"> </span>stop<span style="color:#c0c0c0;"> </span>&lt;-<span style="font-weight:600;color:#000080;">chan</span><span style="color:#c0c0c0;"> </span><span style="font-weight:600;color:#000080;">struct</span>{})<span style="color:#c0c0c0;"> </span>(*types.Block,<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span>)</pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">CalcDifficulty</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">difficulty</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">adjustment</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">algorithm.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">It</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">returns</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">difficulty</span></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">that</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">new</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">should</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">have.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>CalcDifficulty(chain<span style="color:#c0c0c0;"> </span>ChainReader,<span style="color:#c0c0c0;"> </span>time<span style="color:#c0c0c0;"> </span><span style="color:#000080;">uint64</span>,<span style="color:#c0c0c0;"> </span>parent<span style="color:#c0c0c0;"> </span>*types.Header)<span style="color:#c0c0c0;"> </span>*big.Int</pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">APIs</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">returns</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">RPC</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">APIs</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">this</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">provides.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>APIs(chain<span style="color:#c0c0c0;"> </span>ChainReader)<span style="color:#c0c0c0;"> </span>[]rpc.API</pre>
  <pre>}</pre>
  <pre></pre>
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">PoW</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">based</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">on</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">proof-of-work.</span></pre>
  <pre><span style="font-weight:600;color:#000080;">type</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">PoW</span><span style="color:#c0c0c0;"> </span><span style="font-weight:600;color:#000080;">interface</span><span style="color:#c0c0c0;"> </span>{</pre>
  <pre><span style="color:#c0c0c0;">	</span>Engine</pre>
  <pre></pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Hashrate</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">returns</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">current</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">mining</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">hashrate</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">PoW</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">consensus</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">engine.</span></pre>
  <pre><span style="color:#c0c0c0;">	</span>Hashrate()<span style="color:#c0c0c0;"> </span><span style="color:#000080;">float64</span></pre>
  <pre>}</pre>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">在consensus目录下还有Engine的两个具体实现：</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">1）clique (测试网络使用），基于POA（proof of authority) &nbsp;2）ethash（正式网络使用），基于POW（proof of work）。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><span><strong>2）打包出块速度</strong></span></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">在上图中的Engine的接口中，有个接口函数 - CalcDifficulty。这个接口是计算当前区块的难度，调节以太网络的出块速度。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">查看ethash的实现，CalcDifficulty函数实现在consensus/ethash/consensus.go文件：</p>
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">CalcDifficulty</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">is</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">difficulty</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">adjustment</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">algorithm.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">It</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">returns</span></pre>
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">difficulty</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">that</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">new</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">should</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">have</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">when</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">created</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">at</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">time</span></pre>
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">given</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">parent</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">block's</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">time</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">and</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">difficulty.</span></pre>
  <pre><span style="font-weight:600;color:#000080;">func</span><span style="color:#c0c0c0;"> </span>CalcDifficulty(config<span style="color:#c0c0c0;"> </span>*params.ChainConfig,<span style="color:#c0c0c0;"> </span>time<span style="color:#c0c0c0;"> </span><span style="color:#000080;">uint64</span>,<span style="color:#c0c0c0;"> </span>parent<span style="color:#c0c0c0;"> </span>*types.Header)<span style="color:#c0c0c0;"> </span>*big.Int<span style="color:#c0c0c0;"> </span>{</pre>
  <pre><span style="color:#c0c0c0;">	</span>next<span style="color:#c0c0c0;"> </span>:=<span style="color:#c0c0c0;"> </span><span style="color:#000080;">new</span>(big.Int).Add(parent.Number,<span style="color:#c0c0c0;"> </span>big1)</pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="font-weight:600;color:#000080;">switch</span><span style="color:#c0c0c0;"> </span>{</pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="font-weight:600;color:#000080;">case</span><span style="color:#c0c0c0;"> </span>config.IsByzantium(next):</pre>
  <pre><span style="color:#c0c0c0;">		</span><span style="font-weight:600;color:#000080;">return</span><span style="color:#c0c0c0;"> </span>calcDifficultyByzantium(time,<span style="color:#c0c0c0;"> </span>parent)</pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="font-weight:600;color:#000080;">case</span><span style="color:#c0c0c0;"> </span>config.IsHomestead(next):</pre>
  <pre><span style="color:#c0c0c0;">		</span><span style="font-weight:600;color:#000080;">return</span><span style="color:#c0c0c0;"> </span>calcDifficultyHomestead(time,<span style="color:#c0c0c0;"> </span>parent)</pre>
  <pre><span style="color:#c0c0c0;">	</span><span style="font-weight:600;color:#000080;">default</span>:</pre>
  <pre><span style="color:#c0c0c0;">		</span><span style="font-weight:600;color:#000080;">return</span><span style="color:#c0c0c0;"> </span>calcDifficultyFrontier(time,<span style="color:#c0c0c0;"> </span>parent)</pre>
  <pre><span style="color:#c0c0c0;">	</span>}</pre>
  <pre>}</pre>
  <pre></pre>
  <p><span style="color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">以太根据块的高度做了一些难度策略的调整。这里着重看一下，最新的策略：calcDifficultyByzantium函数。</span></p>
  <pre><code class="language-plain">// calcDifficultyByzantium is the difficulty adjustment algorithm. It returns
// the difficulty that a new block should have when created at time given the
// parent block's time and difficulty. The calculation uses the Byzantium rules.
func calcDifficultyByzantium(time uint64, parent *types.Header) *big.Int {
	// https://github.com/ethereum/EIPs/issues/100.
	// algorithm:
	// diff = (parent_diff +
	//         (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99))
	//        ) + 2^(periodCount - 2)
	bigTime := new(big.Int).SetUint64(time)
	bigParentTime := new(big.Int).Set(parent.Time)
	// holds intermediate values to make the algo easier to read &amp; audit
	x := new(big.Int)
	y := new(big.Int)
	// (2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9
	x.Sub(bigTime, bigParentTime)
	x.Div(x, big9)
	if parent.UncleHash == types.EmptyUncleHash {
		x.Sub(big1, x)
	} else {
		x.Sub(big2, x)
	}
	// max((2 if len(parent_uncles) else 1) - (block_timestamp - parent_timestamp) // 9, -99)
	if x.Cmp(bigMinus99) &lt; 0 {
		x.Set(bigMinus99)
	}
	// parent_diff + (parent_diff / 2048 * max((2 if len(parent.uncles) else 1) - ((timestamp - parent.timestamp) // 9), -99))
	y.Div(parent.Difficulty, params.DifficultyBoundDivisor)
	x.Mul(y, x)
	x.Add(parent.Difficulty, x)
	// minimum difficulty can ever be (before exponential factor)
	if x.Cmp(params.MinimumDifficulty) &lt; 0 {
		x.Set(params.MinimumDifficulty)
	}
	// calculate a fake block number for the ice-age delay:
	//   https://github.com/ethereum/EIPs/pull/669
	//   fake_block_number = min(0, block.number - 3_000_000
	fakeBlockNumber := new(big.Int)
	if parent.Number.Cmp(big2999999) &gt;= 0 {
		fakeBlockNumber = fakeBlockNumber.Sub(parent.Number, big2999999) // Note, parent is 1 less than the actual block number
	}
	// for the exponential factor
	periodCount := fakeBlockNumber
	periodCount.Div(periodCount, expDiffPeriod)
	// the exponential factor, commonly referred to as "the bomb"
	// diff = diff + 2^(periodCount - 2)
	if periodCount.Cmp(big1) &gt; 0 {
		y.Sub(periodCount, big2)
		y.Exp(big2, y, nil)
		x.Add(x, y)
	}
	return x
}</code></pre>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">在函数的注释中，明确给出了难度调整的算法。算法调整分为两个部分：</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><span>1）<strong>parent_diff/2048*max(1-(时间差/9), -99) （如果没有叔块）</strong></span></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">简单的说，假设当前块和上一块的时间差为X秒：</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">X&lt;9: 增加难度，增加上一块区块难度的1/2048。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">9&lt;X&lt;18: 保持上一块区块难度不变。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">X&gt;27: 减少难度，较少上一块区块难度的1/2048个倍数，倍数最大为99。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><span>2）<strong>2^(periodCount-2) （又称难度炸弹）</strong></span></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">periodCount的计算公式：(上个区块的高度 - 3000000)/100000。从etherscan上查看最新的区块信息：</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180529202558697" alt=""><br></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);">当前的高度是5577040，难度炸弹的值为：2^23 = 8388608。目前，这个炸弹的值相对来说可以忽略。</p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;letter-spacing:.544px;background-color:rgb(255,255,255);"><span>总结一下：</span>目前难度调整的目的是将打包速度调整在9到18秒之间。也就是，大多数人说的，打包时间大约15秒。</p>
  <br>
  <img src="https://img-blog.csdn.net/2018052920263169" alt="">
  <br> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Metal1/article/details/80501519,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Metal1/article/details/80501519,&quot;}">阅读更多</a> 
</div>
      <br />
        <a href="https://blog.uzzz.org/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://blog.uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://blog.uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
    <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
    </script>

  </body>
</html>
